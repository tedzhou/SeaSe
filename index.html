<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>看房check list</title>
<style>
    /* 可选：如果您想要全局禁止zoom，可以添加以下样式 */
    html {
        touch-action: manipulation; /* 禁止双击缩放 */
        -webkit-text-size-adjust: 100%; /* 禁止iOS自动调整字体大小 */
    }

    body { font-family: Arial, sans-serif; }
    select, button, input[type="text"] { 
        height: 40px;
        -webkit-appearance: none; /* 移除iOS默认的外观 */
        -webkit-text-size-adjust: 100%; /* 禁止iOS自动调整字体大小 */
        font-size: 16px; /* 设置合适的字体大小 */
        margin-bottom: 10px;
    }
    select, button {
        padding: 10px;
        width: 100%;
    }
    input[type="text"] {
        width: 70%;
    }
    button { cursor: pointer; }
    a { margin-right: 5px; text-decoration: none; color: blue; }
    a:hover { text-decoration: underline; }
    p { font-size: 16px; color: #666; }
    h2 { color: #333; }
    h3 { color: #666; }
    #saveImageButton { margin-top: 20px; }
    #snapshotImage {
        width: 50%;
        height: auto;
        margin-top: 20px;
        border: 1px solid #ddd;
    }
</style>
</head>
<body>

<h1>看房check list</h1>
<h2>0. 楼盘名称</h2>
<input type="text" id="" placeholder="请输入楼盘名称">

<h2>1. 学位确认</h2>
<p>请询问中介该房产对应的小学，以便查阅初中属于哪个分组，从而估算孩子就读优质学校的概率。</p>
<label for="district">选择区域:</label>
<br>
<select id="district" onchange="loadSchools()">
    <option value="">请选择区域</option>
    <option value="liwan">荔湾区</option>
    <option value="haizu">海珠区</option>
</select>
<br>

<label for="school">选择小学:</label>
<br>
<select id="school" onchange="displayInfo()">
    <option value="">请选择小学</option>
</select>

<div id="result">
    <h2></h2>
</div>

<!-- 房子价值计算 -->
<h2>2. 房子价值计算</h2>
<p>房子价值估算公式为：<br>
  <strong>房子价值 = 年租金 * 30 + 学位价值</strong><br>
  其中年租金 = 月租金 * 12
</p>
<label for="monthlyRent">租金 (元/月):</label>
<br>
<input type="text" id="monthlyRent" placeholder="请输入租金">
<br>

<label for="price">总房价 (万元):</label>
<br>
<input type="text" id="price" placeholder="请输入总房价">
<br>

<label for="schoolValue">学位估值 (万元):</label>
<br>
<input type="text" id="schoolValue" placeholder="请输入学位估值">
<br>

<button onclick="calculateHouseValue()">估算房屋价值</button>
<div id="houseValueResult"></div>

<!-- 交通导航 -->
<h2>3. 交通检查</h2>
<p>请检查房产周边的交通情况，确保通勤便利。</p>
<a href="//uri.amap.com/search?keyword=广州T.I.T创意园&city=Guangzhou&src=mypage&callnative=1&view=map" target="_blank">导航到广州T.I.T创意园</a>
<br>
<a href="//uri.amap.com/search?keyword=阿里中心·广州琶洲&city=Guangzhou&src=mypage&callnative=1&view=map" target="_blank">导航到阿里阿里中心·广州琶洲</a>

<script>
let liwanData;
let haizuData;
function loadSchools() {
    const district = document.getElementById('district').value;
    const schoolSelect = document.getElementById('school');
    schoolSelect.innerHTML = '<option value="">请选择小学</option>'; // 清空现有选项

    if (district === 'liwan' && liwanData) {
        updateSchools(liwanData);
    } else if (district === 'haizu' && haizuData) {
        updateSchools(haizuData);
    } else {
        if (district === 'liwan') {
            fetch('liwan.json')
                .then(response => response.json())
                .then(data => {
                    liwanData = data;
                    updateSchools(data);
                });
        } else if (district === 'haizu') {
            fetch('haizu.json')
                .then(response => response.json())
                .then(data => {
                    haizuData = data;
                    updateSchools(data);
                });
        }
    }
}

function updateSchools(data) {
    const schoolSelect = document.getElementById('school');
    const schools = Object.values(data).reduce((acc, group) => {
        group.elementarySchools.forEach(school => {
            if (!acc.includes(school)) {
                acc.push(school);
            }
        });
        return acc;
    }, []);
    schools.sort(); // Sort schools alphabetically
    schools.forEach(school => {
        const option = document.createElement('option');
        option.value = school;
        option.textContent = school;
        schoolSelect.appendChild(option);
    });
}

function displayInfo() {
    const schoolName = document.getElementById('school').value;
    const resultDiv = document.getElementById('result');
    if (!schoolName) {
        resultDiv.innerHTML = '<h3>请先选择一个小学</h3>';
        return;
    }

    const selectedDistrict = document.getElementById('district').value;
    const data = selectedDistrict === 'liwan' ? liwanData : haizuData;
    const groupInfo = Object.entries(data).find(([group, {elementarySchools}]) => elementarySchools.includes(schoolName));
    if (groupInfo) {
        const [group, {middleSchools}] = groupInfo;
        const middleSchoolLinks = middleSchools.map(school => 
            `<a href="//uri.amap.com/search?keyword=${encodeURIComponent(school)}&city=Guangzhou&src=mypage&callnative=1&view=map" target="_blank">${school}</a>`
        ).join('<br>');
        resultDiv.innerHTML = `
            <h2><a href="//uri.amap.com/search?keyword=${encodeURIComponent(schoolName)}&city=Guangzhou&src=mypage&callnative=1&view=map" target="_blank">${schoolName}</a> 所在的分组是 ${group}</h2>
            <strong>对应的初中:</strong><br>${middleSchoolLinks}
        `;
    } else {
        resultDiv.innerHTML = `<h3>${schoolName} 没有找到对应的分组信息。</h3>`;
    }
}
function calculateHouseValue() {
    // let million = 1000000;
    let wan = 10 * 1000;
    const monthlyRent = parseFloat(document.getElementById('monthlyRent').value);
    const schoolValue = parseFloat(document.getElementById('schoolValue').value) * wan;
    const totalHousePrice = parseFloat(document.getElementById('price').value) * wan;
    let houseValue = (monthlyRent * 12 * 30) + schoolValue;
    let premium = ((totalHousePrice - houseValue) / houseValue) * 100;
    document.getElementById('houseValueResult').innerHTML = `房子价值: ${(houseValue / wan).toFixed(2)}万元<br>溢价: ${premium.toFixed(2)}%`;
}

document.getElementById('district').addEventListener('change', loadSchools);
</script>
<button id="saveImageButton">保存页面为图片</button>
<img id="snapshotImage" src="" alt="页面快照" style="display: none;">
<script src="html2canvas.js"></script>
<script>
document.getElementById('saveImageButton').addEventListener('click', function() {
    html2canvas(document.body).then(canvas => {
        const image = canvas.toDataURL('image/png');
        document.getElementById('snapshotImage').src = image;
        document.getElementById('snapshotImage').style = "";

        alert('图片已生成，长按图片保存到相册');
    });
});
</script>
</body>
</html>
